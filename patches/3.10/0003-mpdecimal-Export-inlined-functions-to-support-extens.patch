From f5f464c478f754a8f25c7fa4ddf37e7b41540885 Mon Sep 17 00:00:00 2001
From: Jean-Christophe Fillion-Robin <jchris.fillionr@kitware.com>
Date: Mon, 6 Nov 2017 11:27:32 -0500
Subject: [PATCH 3/3] mpdecimal: Export inlined functions to support extension
 built-in on windows

This commit ensures that symbols are available when building _freeze_importlib
with all extensions built-in on windows.

It addresses the following link error associated
with CMakeBuild\libpython\_freeze_importlib.vcxproj:

  3>_decimal.obj : error LNK2019: unresolved external symbol _mpd_del referenced in function _PyDec_AsTuple
  3>io.obj : error LNK2001: unresolved external symbol _mpd_del
  3>basearith.obj : error LNK2019: unresolved external symbol _mpd_uint_zero referenced in function __mpd_baseshiftl
  3>io.obj : error LNK2019: unresolved external symbol _mpd_qresize referenced in function _mpd_qset_string
---
 Modules/_decimal/libmpdec/mpdecimal.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/Modules/_decimal/libmpdec/mpdecimal.c b/Modules/_decimal/libmpdec/mpdecimal.c
index f1626df..1dbc85b 100644
--- a/Modules/_decimal/libmpdec/mpdecimal.c
+++ b/Modules/_decimal/libmpdec/mpdecimal.c
@@ -63,7 +63,7 @@
 
 
 #if defined(_MSC_VER)
-  #define ALWAYS_INLINE __forceinline
+  #define ALWAYS_INLINE extern __forceinline
 #elif defined (__IBMC__) || defined(LEGACY_COMPILER)
   #define ALWAYS_INLINE
   #undef inline
@@ -517,7 +517,7 @@ mpd_qresize(mpd_t *result, mpd_ssize_t nwords, uint32_t *status)
 }
 
 /* Same as mpd_qresize, but do not set the result no NaN on failure. */
-static ALWAYS_INLINE int
+static inline int
 mpd_qresize_cxx(mpd_t *result, mpd_ssize_t nwords)
 {
     assert(!mpd_isconst_data(result)); /* illegal operation for a const */
-- 
2.47.2

